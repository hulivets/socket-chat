(this["webpackJsonpsocket-chat"]=this["webpackJsonpsocket-chat"]||[]).push([[0],{31:function(e,t,n){},37:function(e,t,n){},38:function(e,t,n){},40:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){},43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){"use strict";n.r(t);var c=n(1),s=n.n(c),a=n(22),r=n.n(a),i=n(8),o=n(7),u=n(0),l={userName:"",isLogged:!1},d=Object(c.createContext)(l),j=d.Provider,f=function(e){var t=e.children,n=Object(c.useReducer)((function(e,t){switch(t.type){case"LOGIN":return e=Object(i.a)(Object(i.a)({},t.payload),{},{isLogged:!0});case"LOG_OUT":return e=Object(i.a)({},l);default:return e}}),l),s=Object(o.a)(n,2),a=s[0],r=s[1];return Object(u.jsx)(j,{value:{state:a,dispatch:r},children:t})},m=n(10),b=n(2),v=n(25),O=(n(31),function(e){var t=e.children;return Object(u.jsx)("div",{className:"main-layout",children:t})}),h=function(e){var t=e.component,n=Object(v.a)(e,["component"]),c=O;return Object(u.jsx)(b.b,Object(i.a)(Object(i.a)({},n),{},{render:function(e){return Object(u.jsx)(c,{children:Object(u.jsx)(t,Object(i.a)({},e))})}}))},g=n(13),p=(n(37),function(e){var t=e.name,n=e.value,s=e.placeholder,a=e.onChange,r=Object(c.useRef)(null);return Object(c.useEffect)((function(){var e;null===(e=r.current)||void 0===e||e.focus()})),Object(u.jsx)("div",{className:"text-input",children:Object(u.jsx)("input",{ref:r,name:t,className:"input",value:n,autoComplete:"off",placeholder:s,onChange:a})})});p.defaultProps={name:"",value:"",placeholder:"",onChange:null};var N=p,x=(n(38),function(e){var t=e.type,n=e.text,c=e.onClick;return Object(u.jsx)("button",{className:"button",type:t,onClick:c,children:n})});x.defaultProps={text:"",type:"button",onClick:null};var _,C,E,S,y=x,D=n(20),T=n.n(D),k=n(24),L=[],w=function(e){var t=(null===e||void 0===e?void 0:e.data)||"";L.forEach((function(e){return e(t)}))},M={connect:function(){return _&&this.closeConnection(),new Promise((function(e,t){(_=new WebSocket("wss://socketio-chat-h9jt.herokuapp.com/socket.io/?EIO=3&transport=websocket")).onopen=function(){e(_),C=setInterval((function(){return _.send("2")}),2e4),console.log("WEB SOCKET CHANNEL CONNECTED")},_.onerror=function(){t(_)}}))},login:function(e){var t;null===(t=_)||void 0===t||t.send(e),_.addEventListener("message",w)},sucbscribe:function(e){L.push(e)},unSubscribe:function(e){L=L.filter((function(t){return t!==e}))},sendMessage:function(e){var t;null===(t=_)||void 0===t||t.send(e)},closeConnection:function(){var e,t;C&&clearInterval(C),null===(e=_)||void 0===e||e.removeEventListener("message",w),null===(t=_)||void 0===t||t.close(),console.log("WEB SOCKET CHANNEL CLOSED")}};!function(e){e.ADD_USER="add user",e.LOGIN="login",e.USER_JOINED="user joined",e.USER_LEFT="user left",e.NEW_MESSAGE="new message",e.TYPYNG="typing",e.STOP_TYPING="stop typing"}(E||(E={})),function(e){e.SEND="42",e.UPDATE="2"}(S||(S={}));var P,G=function(){var e=Object(c.useContext)(d).dispatch;return{login:function(){var t=Object(k.a)(T.a.mark((function t(n,c){var s;return T.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,M.connect();case 3:t.sent.readyState===WebSocket.OPEN&&(s=S.SEND+JSON.stringify([E.ADD_USER,n]),M.login(s),e({type:"LOGIN",payload:{userName:n}}),c()),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,n){return t.apply(this,arguments)}}(),sucbscribe:function(e){M.sucbscribe(e)},unsucbscribe:function(e){M.unSubscribe(e)},sendMessage:function(e){var t=S.SEND+JSON.stringify([E.NEW_MESSAGE,e]);M.sendMessage(t)},sendTypingMessage:function(e,t){var n=t?E.TYPYNG:E.STOP_TYPING,c=S.SEND+JSON.stringify([n,{username:e}]);M.sendMessage(c)},logout:function(){e({type:"LOG_OUT"}),M.closeConnection()}}};!function(e){e.LOGIN="/",e.CHAT_ROOM="/chat-room"}(P||(P={}));n(40);var I=function(){var e=Object(c.useState)({userName:""}),t=Object(o.a)(e,2),n=t[0],s=t[1],a=Object(b.g)(),r=G().login;return Object(u.jsx)("div",{className:"login-form",children:Object(u.jsxs)("form",{action:"",className:"login-form__form",children:[Object(u.jsx)("div",{className:"login-form__field-wrapper",children:Object(u.jsx)(N,{name:"userName",placeholder:"Name",value:n.userName,onChange:function(e){s(Object(g.a)({},e.target.name,e.target.value))}})}),Object(u.jsx)("div",{className:"login-form__field-wrapper",children:Object(u.jsx)(y,{text:"Join",type:"submit",onClick:function(e){e.preventDefault(),n.userName.trim()&&(r(n.userName.trim(),(function(){return a.push(P.CHAT_ROOM)})),s({userName:""}))}})})]})})},A=(n(41),function(){return Object(u.jsx)("div",{className:"login-page",children:Object(u.jsx)("div",{className:"login-page__login-form-wrapper",children:Object(u.jsx)(I,{})})})}),R=n(15),U=(n(42),function(e){var t=e.onActionClick;return Object(u.jsx)("div",{className:"header",children:Object(u.jsxs)("div",{className:"header__content",children:[Object(u.jsx)("div",{className:"header__chat-name",children:"Socket Chat"}),Object(u.jsx)("div",{className:"header__action-icon",title:"Log out",onClick:function(e){t()}})]})})});U.defautProps={onActionClick:function(){return null}};var J=U,W=(n(43),function(e){var t=e.userName,n=e.userMessage,s=e.userColor,a=Object(c.useRef)(null);return Object(c.useEffect)((function(){var e;null===(e=a.current)||void 0===e||e.scrollIntoView()})),Object(u.jsx)("div",{className:"chat-message",ref:a,children:Object(u.jsxs)("div",{className:"chat-message__content",children:[Object(u.jsx)("div",{className:"chat-message__avatar-wrapper",children:Object(u.jsx)("div",{className:"chat-message__avatar",style:{backgroundColor:s},children:t.charAt(0).toUpperCase()})}),Object(u.jsxs)("div",{className:"chat-message__user-content",children:[Object(u.jsx)("div",{className:"chat-message__user-name",style:{color:s},children:t}),Object(u.jsx)("div",{className:"chat-message__user-message",children:n})]})]})})});W.defaultProps={userName:"",userMessage:"",userColor:"#CCCCCC"};var Y=s.a.memo(W),F=(n(44),function(e){var t=e.text,n=e.userName,c=e.userQuantity;return Object(u.jsx)("div",{className:"user-activity-info",children:Object(u.jsxs)("div",{className:"user-activity-info__content",children:[Object(u.jsx)("div",{className:"user-activity-info__user",children:n&&t&&Object(u.jsxs)("span",{children:[n," ",t]})}),Object(u.jsx)("div",{className:"user-activity-info__user-quantity",children:Object(u.jsxs)("span",{children:["participants online: ",c]})})]})})});F.defaultProps={text:"",userName:"",userQuantity:0};var H=s.a.memo(F),B=["#f0a500","#c15050","#ce1f6a","#7eca9c","#046582","#92967d","#8c0000","#d8c292","#ff9292","#3b88eb","#62959c","#00917c"],Q=(n(45),n(46),function(e){var t=e.text,n=e.userColor;return Object(u.jsx)("div",{className:"typing-message",children:Object(u.jsx)("div",{className:"typing-message__text",style:{color:n},children:t})})});Q.defaultProps={text:"",userColor:"#CCCCCC"};var K=s.a.memo(Q),q=function(e){var t=e.messages,n=e.typingData,c=function(){var e=new Map;return function(t){if(e.has(t))return e.get(t);for(var n=7,c=0;c<t.length;c++)n=t.charCodeAt(c)+(n<<5)-n;var s=Math.abs(n%B.length);return e.set(t,B[s]),B[s]}}(),s=function(e){var t,n,s;return Object(u.jsx)(Y,{id:e.id,userName:null===(t=e.userData)||void 0===t?void 0:t.username,userMessage:null===(n=e.userData)||void 0===n?void 0:n.message,userColor:c((null===(s=e.userData)||void 0===s?void 0:s.username)||"")},e.id)},a=function(e){var t,n,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(u.jsx)(H,{userName:null===(t=e.userData)||void 0===t?void 0:t.username,text:c,userQuantity:null===(n=e.userData)||void 0===n?void 0:n.numUsers},e.id)};return Object(u.jsx)("div",{className:"chat-messages-list",children:Object(u.jsxs)("div",{className:"chat-messages-list__content",children:[Object(u.jsx)("div",{className:"chat-messages-list__welcome-wrapper",children:Object(u.jsx)("div",{className:"chat-messages-list__welcome-text",children:"Welcome to Socket Chat \ud83d\udc4b"})}),t.map((function(e){return function(e){switch(e.type){case E.NEW_MESSAGE:return s(e);case E.USER_JOINED:return a(e,"joined \ud83e\udd73");case E.USER_LEFT:return a(e,"left \ud83e\udd25");case E.LOGIN:return a(e);default:return null}}(e)})),Object(u.jsx)("div",{className:"chat-messages-list__typing-message",children:n.map((function(e){var t,n;return Object(u.jsx)(K,{text:"".concat(null===(t=e.userData)||void 0===t?void 0:t.username," typing..."),userColor:c((null===(n=e.userData)||void 0===n?void 0:n.username)||"")},e.id)}))})]})})};q.defaultProps={messages:[]};var V=q,z=(n(47),function(e){var t=e.onSubmit,n=e.sendTyping,s=Object(c.useState)(""),a=Object(o.a)(s,2),r=a[0],i=a[1],l=Object(c.useState)(!1),d=Object(o.a)(l,2),j=d[0],f=d[1];return Object(c.useEffect)((function(){var e;return j&&(e=setTimeout((function(){n(!1),f(!1)}),500)),function(){return clearTimeout(e)}}),[r]),Object(u.jsx)("div",{className:"chat-message-form",children:Object(u.jsxs)("form",{action:"",className:"chat-message-form__form",children:[Object(u.jsx)("div",{className:"chat-message-form__field-wrapper",children:Object(u.jsx)(N,{name:"userMessage",placeholder:"Message",value:r,onChange:function(e){j||n(!0),f(!0),i(e.target.value)}})}),Object(u.jsx)("div",{className:"chat-message-form__button-wrapper",children:Object(u.jsx)(y,{text:"Send",type:"submit",onClick:function(e){if(e.preventDefault(),t){var n=r.trim();n&&(t(n),i(""))}}})})]})})}),X=n(53),Z=(n(48),function(){var e=Object(c.useState)([]),t=Object(o.a)(e,2),n=t[0],s=t[1],a=Object(c.useState)([]),r=Object(o.a)(a,2),l=r[0],j=r[1],f=Object(c.useContext)(d).state,m=Object(b.g)(),v=G(),O=v.sucbscribe,h=v.unsucbscribe,g=v.sendMessage,p=v.sendTypingMessage,N=v.logout,x=function(e){var t=function(e){if("40"===e||"3"===e)return{};var t=e.slice(2,e.length),n=JSON.parse(t);return{id:Object(X.a)(),type:n[0],userData:Object(i.a)({},n[1])}}(e);switch(null===t||void 0===t?void 0:t.type){case E.TYPYNG:return j((function(e){return[].concat(Object(R.a)(e),[t])}));case E.STOP_TYPING:var n=l.filter((function(e){var n,c;return(null===(n=e.userData)||void 0===n?void 0:n.username)!==(null===(c=t.userData)||void 0===c?void 0:c.username)}));return j(n);default:return s((function(e){return[].concat(Object(R.a)(e),[t])}))}};return Object(c.useEffect)((function(){if(f.isLogged)return O(x),function(){return h(x)};m.push(P.LOGIN)})),Object(u.jsxs)("div",{className:"chat-room-page",children:[Object(u.jsx)(J,{onActionClick:function(){m.push(P.LOGIN),N()}}),Object(u.jsxs)("div",{className:"chat-room-page__content",children:[Object(u.jsx)(V,{messages:n,typingData:l}),Object(u.jsx)(z,{onSubmit:function(e){if(e){var t=function(e,t,n){return{id:Object(X.a)(),type:e,userData:{username:t,message:n}}}(E.NEW_MESSAGE,f.userName,e);g(e),s((function(e){return[].concat(Object(R.a)(e),[t])}))}},sendTyping:function(e){return p(f.userName,e)}})]})]})}),$=function(){return Object(u.jsx)(m.a,{children:Object(u.jsxs)(b.d,{children:[Object(u.jsx)(h,{exact:!0,path:P.LOGIN,component:A}),Object(u.jsx)(h,{exact:!0,path:P.CHAT_ROOM,component:Z}),Object(u.jsx)(b.a,{to:P.LOGIN})]})})},ee=(n(49),n(50),function(){return Object(u.jsx)(f,{children:Object(u.jsx)($,{})})}),te=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,54)).then((function(t){var n=t.getCLS,c=t.getFID,s=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),c(e),s(e),a(e),r(e)}))};r.a.render(Object(u.jsx)(s.a.StrictMode,{children:Object(u.jsx)(ee,{})}),document.getElementById("root")),te()}},[[51,1,2]]]);
//# sourceMappingURL=main.cf382240.chunk.js.map