(this["webpackJsonpsocket-chat"]=this["webpackJsonpsocket-chat"]||[]).push([[0],{31:function(e,t,n){},37:function(e,t,n){},38:function(e,t,n){},40:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){},43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){"use strict";n.r(t);var s=n(1),c=n.n(s),a=n(22),r=n.n(a),i=n(8),o=n(7),u=n(0),l={userName:"",isLogged:!1},d=Object(s.createContext)(l),j=d.Provider,f=function(e){var t=e.children,n=Object(s.useReducer)((function(e,t){switch(t.type){case"LOGIN":return e=Object(i.a)(Object(i.a)({},t.payload),{},{isLogged:!0});case"LOG_OUT":return e=Object(i.a)({},l);default:return e}}),l),c=Object(o.a)(n,2),a=c[0],r=c[1];return Object(u.jsx)(j,{value:{state:a,dispatch:r},children:t})},b=n(10),O=n(2),m=n(25),v=(n(31),function(e){var t=e.children;return Object(u.jsx)("div",{className:"main-layout",children:t})}),h=function(e){var t=e.component,n=Object(m.a)(e,["component"]),s=v;return Object(u.jsx)(O.b,Object(i.a)(Object(i.a)({},n),{},{render:function(e){return Object(u.jsx)(s,{children:Object(u.jsx)(t,Object(i.a)({},e))})}}))},g=n(13),p=(n(37),function(e){var t=e.name,n=e.value,c=e.placeholder,a=e.onChange,r=Object(s.useRef)(null);return Object(s.useEffect)((function(){var e;null===(e=r.current)||void 0===e||e.focus()})),Object(u.jsx)("div",{className:"text-input",children:Object(u.jsx)("input",{ref:r,name:t,className:"input",value:n,autoComplete:"off",placeholder:c,onChange:a})})});p.defaultProps={name:"",value:"",placeholder:"",onChange:null};var N=p,x=(n(38),function(e){var t=e.type,n=e.text,s=e.onClick;return Object(u.jsx)("button",{className:"button",type:t,onClick:s,children:n})});x.defaultProps={text:"",type:"button",onClick:null};var _,C,E,S,y=x,M=n(20),D=n.n(M),T=n(24),L=[],k=[],w=function(e){var t=(null===e||void 0===e?void 0:e.data)||"";L.forEach((function(e){return e(t)}))},P=function(e){k.forEach((function(t){return t(e)}))},G={connect:function(){return _&&this.closeConnection(),new Promise((function(e,t){(_=new WebSocket("wss://socketio-chat-h9jt.herokuapp.com/socket.io/?EIO=3&transport=websocket")).onopen=function(){e(_),C=setInterval((function(){return _.send("2")}),2e4),console.log("WEB SOCKET CHANNEL CONNECTED")},_.addEventListener("close",P),_.onerror=function(){t(_)}}))},login:function(e){var t;null===(t=_)||void 0===t||t.send(e),_.addEventListener("message",w)},sucbscribeOnMessage:function(e){L.push(e)},unSubscribeOnMessage:function(e){L=L.filter((function(t){return t!==e}))},sendMessage:function(e){var t;null===(t=_)||void 0===t||t.send(e)},subscribeOnClose:function(e){k.push(e)},unSubscribeOnClose:function(e){k=k.filter((function(t){return t!==e}))},closeConnection:function(){var e,t,n;C&&clearInterval(C),null===(e=_)||void 0===e||e.removeEventListener("message",w),null===(t=_)||void 0===t||t.removeEventListener("close",P),null===(n=_)||void 0===n||n.close(),console.log("WEB SOCKET CHANNEL CLOSED")}};!function(e){e.ADD_USER="add user",e.LOGIN="login",e.USER_JOINED="user joined",e.USER_LEFT="user left",e.NEW_MESSAGE="new message",e.TYPYNG="typing",e.STOP_TYPING="stop typing"}(E||(E={})),function(e){e.SEND="42",e.UPDATE="2"}(S||(S={}));var I,A=function(){var e=Object(s.useContext)(d).dispatch;return{login:function(){var t=Object(T.a)(D.a.mark((function t(n,s){var c;return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,G.connect();case 3:t.sent.readyState===WebSocket.OPEN&&(c=S.SEND+JSON.stringify([E.ADD_USER,n]),G.login(c),e({type:"LOGIN",payload:{userName:n}}),s()),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,n){return t.apply(this,arguments)}}(),sucbscribeOnMessge:function(e){G.sucbscribeOnMessage(e)},unsucbscribeOnMessge:function(e){G.unSubscribeOnMessage(e)},sucbscribeOnClose:function(e){G.subscribeOnClose(e)},unSucbscribeOnClose:function(e){G.unSubscribeOnClose(e)},sendMessage:function(e){var t=S.SEND+JSON.stringify([E.NEW_MESSAGE,e]);G.sendMessage(t)},sendTypingMessage:function(e,t){var n=t?E.TYPYNG:E.STOP_TYPING,s=S.SEND+JSON.stringify([n,{username:e}]);G.sendMessage(s)},logout:function(){e({type:"LOG_OUT"}),G.closeConnection()}}};!function(e){e.LOGIN="/",e.CHAT_ROOM="/chat-room"}(I||(I={}));n(40);var R=function(){var e=Object(s.useState)({userName:""}),t=Object(o.a)(e,2),n=t[0],c=t[1],a=Object(O.g)(),r=A().login;return Object(u.jsx)("div",{className:"login-form",children:Object(u.jsxs)("form",{action:"",className:"login-form__form",children:[Object(u.jsx)("div",{className:"login-form__field-wrapper",children:Object(u.jsx)(N,{name:"userName",placeholder:"Name",value:n.userName,onChange:function(e){c(Object(g.a)({},e.target.name,e.target.value))}})}),Object(u.jsx)("div",{className:"login-form__field-wrapper",children:Object(u.jsx)(y,{text:"Join",type:"submit",onClick:function(e){e.preventDefault(),n.userName.trim()&&(r(n.userName.trim(),(function(){return a.push(I.CHAT_ROOM)})),c({userName:""}))}})})]})})},U=(n(41),function(){return Object(u.jsx)("div",{className:"login-page",children:Object(u.jsx)("div",{className:"login-page__login-form-wrapper",children:Object(u.jsx)(R,{})})})}),J=n(15),W=(n(42),function(e){var t=e.onActionClick;return Object(u.jsx)("div",{className:"header",children:Object(u.jsxs)("div",{className:"header__content",children:[Object(u.jsx)("div",{className:"header__chat-name",children:"Socket Chat"}),Object(u.jsx)("div",{className:"header__action-icon",title:"Log out",onClick:function(e){t()}})]})})});W.defautProps={onActionClick:function(){return null}};var Y=W,F=(n(43),function(e){var t=e.userName,n=e.userMessage,c=e.userColor,a=Object(s.useRef)(null);return Object(s.useEffect)((function(){var e;null===(e=a.current)||void 0===e||e.scrollIntoView()})),Object(u.jsx)("div",{className:"chat-message",ref:a,children:Object(u.jsxs)("div",{className:"chat-message__content",children:[Object(u.jsx)("div",{className:"chat-message__avatar-wrapper",children:Object(u.jsx)("div",{className:"chat-message__avatar",style:{backgroundColor:c},children:t.charAt(0).toUpperCase()})}),Object(u.jsxs)("div",{className:"chat-message__user-content",children:[Object(u.jsx)("div",{className:"chat-message__user-name",style:{color:c},children:t}),Object(u.jsx)("div",{className:"chat-message__user-message",children:n})]})]})})});F.defaultProps={userName:"",userMessage:"",userColor:"#CCCCCC"};var H=c.a.memo(F),B=(n(44),function(e){var t=e.text,n=e.userName,s=e.userQuantity;return Object(u.jsx)("div",{className:"user-activity-info",children:Object(u.jsxs)("div",{className:"user-activity-info__content",children:[Object(u.jsx)("div",{className:"user-activity-info__user",children:n&&t&&Object(u.jsxs)("span",{children:[n," ",t]})}),Object(u.jsx)("div",{className:"user-activity-info__user-quantity",children:Object(u.jsxs)("span",{children:["participants online: ",s]})})]})})});B.defaultProps={text:"",userName:"",userQuantity:0};var Q=c.a.memo(B),K=["#f0a500","#c15050","#ce1f6a","#7eca9c","#046582","#92967d","#8c0000","#d8c292","#ff9292","#3b88eb","#62959c","#00917c"],q=(n(45),n(46),function(e){var t=e.text,n=e.userColor;return Object(u.jsx)("div",{className:"typing-message",children:Object(u.jsx)("div",{className:"typing-message__text",style:{color:n},children:t})})});q.defaultProps={text:"",userColor:"#CCCCCC"};var V=c.a.memo(q),z=function(e){var t=e.messages,n=e.typingData,s=function(){var e=new Map;return function(t){if(e.has(t))return e.get(t);for(var n=7,s=0;s<t.length;s++)n=t.charCodeAt(s)+(n<<5)-n;var c=Math.abs(n%K.length);return e.set(t,K[c]),K[c]}}(),c=function(e){var t,n,c;return Object(u.jsx)(H,{id:e.id,userName:null===(t=e.userData)||void 0===t?void 0:t.username,userMessage:null===(n=e.userData)||void 0===n?void 0:n.message,userColor:s((null===(c=e.userData)||void 0===c?void 0:c.username)||"")},e.id)},a=function(e){var t,n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(u.jsx)(Q,{userName:null===(t=e.userData)||void 0===t?void 0:t.username,text:s,userQuantity:null===(n=e.userData)||void 0===n?void 0:n.numUsers},e.id)};return Object(u.jsx)("div",{className:"chat-messages-list",children:Object(u.jsxs)("div",{className:"chat-messages-list__content",children:[Object(u.jsx)("div",{className:"chat-messages-list__welcome-wrapper",children:Object(u.jsx)("div",{className:"chat-messages-list__welcome-text",children:"Welcome to Socket Chat \ud83d\udc4b"})}),t.map((function(e){return function(e){switch(e.type){case E.NEW_MESSAGE:return c(e);case E.USER_JOINED:return a(e,"joined \ud83e\udd73");case E.USER_LEFT:return a(e,"left \ud83e\udd25");case E.LOGIN:return a(e);default:return null}}(e)})),Object(u.jsx)("div",{className:"chat-messages-list__typing-message",children:n.map((function(e){var t,n;return Object(u.jsx)(V,{text:"".concat(null===(t=e.userData)||void 0===t?void 0:t.username," typing..."),userColor:s((null===(n=e.userData)||void 0===n?void 0:n.username)||"")},e.id)}))})]})})};z.defaultProps={messages:[]};var X=z,Z=(n(47),function(e){var t=e.onSubmit,n=e.sendTyping,c=Object(s.useState)(""),a=Object(o.a)(c,2),r=a[0],i=a[1],l=Object(s.useState)(!1),d=Object(o.a)(l,2),j=d[0],f=d[1];return Object(s.useEffect)((function(){var e;return j&&(e=setTimeout((function(){n(!1),f(!1)}),500)),function(){return clearTimeout(e)}}),[r]),Object(u.jsx)("div",{className:"chat-message-form",children:Object(u.jsxs)("form",{action:"",className:"chat-message-form__form",children:[Object(u.jsx)("div",{className:"chat-message-form__field-wrapper",children:Object(u.jsx)(N,{name:"userMessage",placeholder:"Message",value:r,onChange:function(e){j||n(!0),f(!0),i(e.target.value)}})}),Object(u.jsx)("div",{className:"chat-message-form__button-wrapper",children:Object(u.jsx)(y,{text:"Send",type:"submit",onClick:function(e){if(e.preventDefault(),t){var n=r.trim();n&&(t(n),i(""))}}})})]})})}),$=n(53),ee=(n(48),function(){var e=Object(s.useState)([]),t=Object(o.a)(e,2),n=t[0],c=t[1],a=Object(s.useState)([]),r=Object(o.a)(a,2),l=r[0],j=r[1],f=Object(s.useContext)(d).state,b=Object(O.g)(),m=A(),v=m.sucbscribeOnMessge,h=m.unsucbscribeOnMessge,g=m.sucbscribeOnClose,p=m.unSucbscribeOnClose,N=m.sendMessage,x=m.sendTypingMessage,_=m.logout,C=function(e){var t=function(e){if("40"===e||"3"===e)return{};var t=e.slice(2,e.length),n=JSON.parse(t);return{id:Object($.a)(),type:n[0],userData:Object(i.a)({},n[1])}}(e);switch(null===t||void 0===t?void 0:t.type){case E.TYPYNG:return j((function(e){return[].concat(Object(J.a)(e),[t])}));case E.STOP_TYPING:var n=l.filter((function(e){var n,s;return(null===(n=e.userData)||void 0===n?void 0:n.username)!==(null===(s=t.userData)||void 0===s?void 0:s.username)}));return j(n);default:return c((function(e){return[].concat(Object(J.a)(e),[t])}))}},S=function(){b.push(I.LOGIN),_()};return Object(s.useEffect)((function(){if(f.isLogged)return v(C),g(S),function(){h(C),p(S)};b.push(I.LOGIN)})),Object(u.jsxs)("div",{className:"chat-room-page",children:[Object(u.jsx)(Y,{onActionClick:S}),Object(u.jsxs)("div",{className:"chat-room-page__content",children:[Object(u.jsx)(X,{messages:n,typingData:l}),Object(u.jsx)(Z,{onSubmit:function(e){if(e){var t=function(e,t,n){return{id:Object($.a)(),type:e,userData:{username:t,message:n}}}(E.NEW_MESSAGE,f.userName,e);N(e),c((function(e){return[].concat(Object(J.a)(e),[t])}))}},sendTyping:function(e){return x(f.userName,e)}})]})]})}),te=function(){return Object(u.jsx)(b.a,{basename:"/",children:Object(u.jsxs)(O.d,{children:[Object(u.jsx)(h,{exact:!0,path:I.LOGIN,component:U}),Object(u.jsx)(h,{exact:!0,path:I.CHAT_ROOM,component:ee}),Object(u.jsx)(O.a,{to:I.LOGIN})]})})},ne=(n(49),n(50),function(){return Object(u.jsx)(f,{children:Object(u.jsx)(te,{})})}),se=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,54)).then((function(t){var n=t.getCLS,s=t.getFID,c=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),s(e),c(e),a(e),r(e)}))};r.a.render(Object(u.jsx)(c.a.StrictMode,{children:Object(u.jsx)(ne,{})}),document.getElementById("root")),se()}},[[51,1,2]]]);
//# sourceMappingURL=main.e3a2698d.chunk.js.map